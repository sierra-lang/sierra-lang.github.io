<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'/>
        <meta http-equiv="X-UA-Compatible" content="chrome=1"/>
        <meta name="description" content="Sierra: A SIMD Extension for C++"/>
        <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
        <title>Sierra</title>
    </head>
    <body>
        <div id="header_wrap" class="outer">
            <header class="inner">
                <a id="forkme_banner" href="https://github.com/sierra-lang">View on GitHub</a>
                <h1 id="project_title">Sierra</h1>
                <h2 id="project_tagline">A SIMD Extension for C++</h2>
                <div id="menu">
                    <a class="nav_link" href="#overview">Overview</a>
                    <a class="nav_link" href="#building">Building</a>
                    <a class="nav_link" href="#status">Status</a>
                    <a class="nav_link" href="#publications">Publications</a>
                </div>
                <section id="downloads">
                    <a class="zip_download_link" href="https://github.com/sierra-lang/sierra/zipball/master">Download this project as a .zip file</a>
                    <a class="tar_download_link" href="https://github.com/sierra-lang/sierra/tarball/master">Download this project as a tar.gz file</a>
                </section>
            </header>
        </div>
        <div id="main_content_wrap" class="outer">
            <div id="main_content" class="inner">
                <p>
                    Nowadays, SIMD hardware is omnipresent in computers.
                    Nonetheless, many software projects make hardly use of SIMD instructions:
                    Applications are usually written in general-purpose languages like C++.
                    However, general-purpose languages only provide poor abstractions for SIMD programming enforcing an error-prone, assembly-like programming style.
                </p>

                <p>
                    Sierra combines the full power of C++ with an intuitive and effective way to address SIMD hardware.
                    With Sierra, the programmer can write efficient, portable and maintainable code.
                    It is particularly easy to enhance existing code to run efficiently on SIMD machines.
                </p>

                <h2 id="overview">Overview</h2>
                <p>
                    Sierra's key components are vector types.
                    The programmer can use these types via the keyword <code>varying</code>.
                    Standard operators are overloaded to also work on such vectors:
                </p>
                <p align=center>
                    <img src="images/simd.png" alt="SIMD" title="SIMD" style="max-width:90%;">
                </p>
                <p>
                    Most importantly, the programmer can explicitly trigger vectorization of code by using vectors in control-flow-dependent expressions.
                    In the figure below, the condition <code>v < 3</code> is of vector type.
                    Thus, Sierra enters a special <em>SIMD mode</em>.
                    As the condition only holds for the first and fourth element, <code>v += 2</code> is only performed for the first and fourth element of <code>v</code>.
                    We also say, the first and the fourth <em>lanes</em> are <em>active</em>.
                    The other two lanes are <em>inactive</em>.
                    Analogously, <code>v -= 3</code> is only applied to the second and third element of <code>v</code>.
                </p>
                <p align=center>
                    <img src="images/masking.png" alt="masking in conditional conde" title="masking in conditional conde" style="max-width:75%;">
                </p>

                <h2 id="building">Building</h2>
                <p>
                    In order to build Sierra, we first fetch the official LLVM sources and then Sierra - which acts as drop-in replacement for clang.
                    Additionally, we clone libsierra for supporting headers.
                    We build everything with CMake.
                </p>

                <h3>Build Instructions</h3>
                <h4>Debug Build</h4>
                <p>
                    For a <em>debug</em> build, we do the following:
                </p>
<pre><code>mkdir sierra
cd sierra
mkdir build_debug
mkdir install_debug
git clone https://github.com/sierra-lang/libsierra.git
wget http://llvm.org/releases/3.4.2/llvm-3.4.2.src.tar.gz
tar xzfv llvm-3.4.2.src.tar.gz
mv llvm-3.4.2.src llvm
cd llvm/tools
git clone https://github.com/sierra-lang/sierra.git clang
cd ../../build_debug
cmake ../llvm -DCMAKE_BUILD_TYPE=Debug -DBUILD_SHARED_LIBS=1 -DCMAKE_INSTALL_PREFIX=/path/to/sierra/install_debug/
make
make install</code></pre>

                <p>
                    Alternatively, you can use the cmake-gui tool: <code>cmake-gui ../llvm</code>
                    Then,
                </p>
                <ul>
                    <li>press <code>configure</code></li>
                    <li>set <code>CMAKE_INSTALL_PREFIX</code> to <code>/path/to/sierra/install_debug</code></li>
                    <li>set <code>CMAKE_BUILD_TYPE</code> to <code>Debug</code></li>
                    <li>set <code>BUILD_SHARED_LIBS</code> and</li>
                    <li>press <code>generate</code>.</li>
                </ul>

                <h4>Release Build</h4>

                <p>
                For a <em>release</em> build, setup appropriate <code>build_release</code> and <code>install_release</code> directories, and set <code>CMAKE_BUILD_TYPE=Release</code>.
                </p>

                <h3>Trying it out</h3>
                <p>
                    You can try out the examples in <code>libsierra/benchmark</code>.
                    Pleake make sure that <code>clang++</code> points to your sierra build.
                    Otherwise the switch <code>-fsierra</code>, which turns on the sierra extension, won't be available.
                    Additionally, we assume that you have AVX avialable.
                    If you just have SSE, use <code>-msseX</code> instead of <code>-mavx</code> to select your SSE version.
                    For instance, if you have SSE 4.2, use <code>-msse4.2</code>.
                    Moreover, you want to use a smaller vectorization length.
                    For the vectorized versions build with <code>-DLENGTH=4</code> instead of <code>-DLENGTH=8</code>.
                </p>
                <p>
                    To try out <code>mandelbrot</code> do the following:
                </p>
<pre><code>cd libsierra/benchmark/mandelbrot
clang++ -std=c++11 -fsierra -O2 -ffast-math -mavx mandelbrot.cpp -I../.. -DLENGTH=1 # compile scalar version
./a.out 11                                                                          # benchmark median of 11 runs
clang++ -std=c++11 -fsierra -O2 -ffast-math -mavx mandelbrot.cpp -I../.. -DLENGTH=8 # compile vectorized version
./a.out 11                                                                          # benchmark median of 11 runs</code></pre>
                <p>
                    To try out <code>aobench</code> do the following:
                </p>
<pre><code>cd libsierra/benchmark/aobench
clang++ -std=c++11 -fsierra -O2 -ffast-math -mavx aobench.cpp -I../.. -DLENGTH=1 # compile scalar version
./a.out 256 256 11                                                               # benchmark median of 11 runs
clang++ -std=c++11 -fsierra -O2 -ffast-math -mavx aobench.cpp -I../.. -DLENGTH=8 # compile vectorized version
./a.out 256 256 11                                                               # benchmark median of 11 runs</code></pre>

                <h3>Troubleshooting</h3>

                <h4>Python 2</h4>
                <p>
                    LLVM's build scripts make use of python. 
                    Apparently, python version 3 causes problems. 
                    Thus, you have to stick to python 2. 
                    If you don't want to mess around with your distribution too much, do something like this:
                </p>
<pre><code>cd ~
mkdir bin
ln -s /usr/bin/python2 ~/bin/python
export PATH=~/bin:$PATH</code></pre>
                <p>
                    You can confirm with <code>pyhton --version</code> that python actually points to version 2.
                    Eventually, you may want to put <code>export PATH=~/bin:$PATH</code> into your <code>~/.bashrc</code>.
                </p>

                <h4>Debugging clang</h4>
                <p>
                    Invoke <code>clang</code> with the <code>-cc1</code> switch in order to actually catch breakpoints. 
                    This will just invoke the pure front end - no code generation. 
                    Add <code>-emit-llvm</code> or <code>-emit-obj</code> to peek into later stages. 
                    Use the <code>-v</code> switch to see full command-line arguments and paste them into your gdb-run command.
                </p>

                <h2 id="status">Status</h2>

                <h3>Supported Control-Flow Constructs</h3>
                <p>
                    The following constructs are currently supported in a <em>vectorial</em> context.
                    They still work as normal in <em>scalar</em> context.
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th align="center">Supported?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>if ... else</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>while</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>do ... while</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>for</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>break</code></td>
                            <td align="center"><a href="images/no.png" target="_blank"><img src="images/no.png" alt="check" title="No" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>continue</code></td>
                            <td align="center"><a href="images/no.png" target="_blank"><img src="images/no.png" alt="check" title="No" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>return</code></td>
                            <td align="center"><a href="images/no.png" target="_blank"><img src="images/no.png" alt="check" title="No" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>switch</code></td>
                            <td align="center"><a href="images/no.png" target="_blank"><img src="images/no.png" alt="check" title="No" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>case</code></td>
                            <td align="center"><a href="images/no.png" target="_blank"><img src="images/no.png" alt="check" title="No" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>goto</code></td>
                            <td align="center"><a href="images/no.png" target="_blank"><img src="images/no.png" alt="check" title="No" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>expr || expr</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>expr && expr</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>!expr</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>expr ? expr : expr</code></td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                    </tbody>
                </table>

                <h3>Type System</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th align="center">Supported?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>varying</code> primitive types</td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td>pointers and references to <code>varying</code> types</td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/yes.png" alt="check" title="Yes" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>varying</code> pointers and references</td>
                            <td align="center"><a href="images/yes.png" target="_blank"><img src="images/no.png" alt="check" title="No" style="max-width:100%;"></a></td>
                        </tr>
                        <tr>
                            <td><code>varying</code> structures</td>
                            <td align="center">some initial support is there</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Known Issues</h3>

                <ul>
                    <li>
                        The semantic analysis which checks whether vector lengths match is currently disabled. 
                        There are problems with template instantiation.
                        Mixing vector lengths in an illegal way causes crashes.
                    </li>
                    <li>
                        In some circumstances <code>expr ? expr : expr</code> causes crashes.
                    </li>
                    <li>
                        The attribute <code>spmd(L)</code> cannot depend on a template parameter <code>L</code>.
                    </li>
                </ul>

                <h2 id="publications">Publications</h2>
                <p>
                    <em>Roland Leißa, Immanuel Haffner, and Sebastian Hack</em><br/>
                    <strong><a href="http://www.cdl.uni-saarland.de/papers/lhh14.pdf">Sierra: A SIMD Extension for C++.</a></strong><br/>
                    In Proceedings of Proceedings of the Workshop on Programming models for SIMD/Vector processing (WPMVP), 2014.
                </p>
                <p>
                    <em>Roland Leißa, Sebastian Hack, Ingo Wald, William R. Mark and Matt Pharr</em><br/>
                    <strong><a href="images/sierra.pdf">Extending C/C++ for Portable SIMD Programming.</a></strong><br/>
                    Poster Presentation at the Intel Developer Forum (IDF), San Francisco, CA, USA, September 10-12, 2013.
                </p>
                <p>
                    <em>Roland Leißa, Ingo Wald, and Sebastian Hack</em><br/>
                    <strong><a href="http://www.cdl.uni-saarland.de/papers/leissa_vecimp.pdf">Extending a C-like Language for Portable SIMD Programming.</a></strong><br/>
                    In Proceedings of the Conference on Principles and Practice of Parallel Programming (PPoPP), 2012.
                </p>
            </div>
        </div>
        <div id="footer_wrap" class="outer">
            <div class="inner">
                <p class="inline">© 2014 <a href="http://www.uni-saarland.de/">Saarland University</a></p>
                <ul class="footer_list">
                    <li class="footer_li"><a href="http://www.cdl.uni-saarland.de/">Compiler Design Lab</a></li>
                </ul>
            </div>
        </div>
    </body>
</html>
